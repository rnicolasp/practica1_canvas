<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Papelera de Reciclaje</title>

    <link rel="stylesheet" th:href="@{/css/home.css}">

    <style>
        /* Estilos específicos SOLO para la papelera */
        /* Mantenemos el diseño de fila y el color rojo de fondo para ítems borrados */
        .trash-list { list-style: none; padding: 0; margin-top: 20px; }

        .trash-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff0f0;
            border: 1px solid #ffcccc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
        }

        .trash-info h4 { margin: 0 0 5px 0; color: #d9534f; font-size: 1.1rem; }
        .trash-info p { margin: 0; font-size: 0.9em; color: #666; }

        .actions { display: flex; gap: 10px; }

        /* Colores específicos que pediste mantener (usamos !important por si home.css interfiere) */
        .btn-restore {
            background-color: #5cb85c !important;
            color: white !important;
            border: none;
        }
        .btn-restore:hover { background-color: #4cae4c !important; }

        .btn-delete {
            background-color: #d9534f !important;
            color: white !important;
            border: none;
        }
        .btn-delete:hover { background-color: #c9302c !important; }

        .empty-msg { text-align: center; color: #888; margin-top: 40px; font-style: italic; }
    </style>
</head>
<body>

<div class="page-wrapper">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="margin: 0;">Papelera de Reciclaje</h2>
            <a th:href="@{/profile}">
                <button>← Volver al Perfil</button>
            </a>
        </div>
        <hr>

        <div th:if="${trashList.isEmpty()}" class="empty-msg">
            <p>No hay elementos en la papelera.</p>
        </div>

        <ul th:unless="${trashList.isEmpty()}" class="trash-list">
            <li th:each="canvas : ${trashList}" class="trash-item" th:id="'row-' + ${canvas.id}">
                <div class="trash-info">
                    <h4 th:text="${canvas.name}">Nombre del Canvas</h4>
                    <p>ID: <span th:text="${canvas.id}">0</span></p>
                </div>

                <div class="actions">
                    <button class="btn-restore" th:onclick="'restoreCanvas(' + ${canvas.id} + ')'">
                        ♻️ Restaurar
                    </button>

                    <button class="btn-delete" th:onclick="'deletePermanent(' + ${canvas.id} + ')'">
                        ❌ Eliminar definitivamente
                    </button>
                </div>
            </li>
        </ul>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    function restoreCanvas(id) {
        if(!confirm("¿Quieres restaurar este dibujo y devolverlo a tu perfil?")) return;

        fetch('/bin/restore?id=' + id, { method: 'POST' })
        .then(response => {
            if (response.ok) {
                removeRow(id);
            } else {
                alert("Error al restaurar.");
            }
        })
        .catch(err => console.error(err));
    }

    function deletePermanent(id) {
        if(!confirm("⚠️ ¡CUIDADO! ⚠️\n\n¿Estás seguro de que quieres eliminar esto PARA SIEMPRE?\nEsta acción no se puede deshacer.")) return;

        fetch('/bin/deletePermanent?id=' + id, { method: 'POST' })
        .then(response => {
            if (response.ok) {
                removeRow(id);
            } else {
                alert("Error al eliminar definitivamente.");
            }
        })
        .catch(err => console.error(err));
    }

    function removeRow(id) {
        const row = document.getElementById('row-' + id);
        if (row) {
            row.style.transition = 'opacity 0.3s';
            row.style.opacity = '0';
            setTimeout(() => {
                row.remove();
                if(document.querySelectorAll('.trash-item').length === 0) {
                    location.reload();
                }
            }, 300);
        }
    }
    /*]]>*/
</script>

</body>
</html>